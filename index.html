<!DOCTYPE html>
<html>
<head>
    <title>DataTransformationTools</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <style type="text/css">
    .trans-area div{
        margin: 5px auto;
    }
    .trans-area b{
        display: inline-block;
        min-width: 90px\0;
        min-width: 85px;
    }
    .trans-area input{
        margin-right: 10px;
        min-width: 200px;
        vertical-align: baseline;
    }
    #transform{
        margin-top: 10px;
        min-width: 150px;
        height: 35px;
        background: #d74717;
        border: none;
        color: #ffffff;
        letter-spacing: 1px;
    }
    #transform:hover{
        background: #df4f1e;
    }
    .trans-area .trans-ex{
        margin-bottom: 10px;
    }
    .trans-area input[type=button],
    .search-area input[type=button]{
        margin-right: 10px;
        margin-top: 10px;
        min-width: 200px;
        vertical-align: baseline;
        background: #c33302;
        height: 35px;
        color: #ffffff;
        border: 0px;
        letter-spacing: 1px;
        font-weight: 600;
    }
    input::-webkit-input-placeholder {color:#ccc;}
    input::-moz-placeholder {color:#ccc;}
    input::-ms-input-placeholder {color:#ccc;}
    .script-left{
        display: inline-block;
        border-right: 1px solid #f5f5f5;
        padding: 20px 50px 20px 0;
    }
    .script-left b{
        display: inline-block;
        min-width: 150px;
    }
    .script-left input{
        margin-top: 10px;
    }
    .script-right{
        display: inline-block;
        max-width: 420px;
        vertical-align: top;
        padding: 30px 0 20px 50px;
    }
    .script-right span{
        word-break: break-all;
    }
    .script-right span[id^="outscript"]{
        display: none;
    }
    .null-input{
        border: 1px solid #c33302!important;
    }
</style>
</head>
<body>
    <xmp theme="united">

    </xmp>
    <div class="container">
        <form class="trans-area">
            <div>
                <div class="trans-ex"><b>String</b></div>
                <div class="trans-ex"><b>e.g</b>： 7472616e73666572 - transfer</div>
                <b>Hex String</b>：
                <input id="inString" type="text" placeholder="7472616e73666572" maxlength="50" />----> String ：
                <span id="outString" class="trans-text"></span>
            </div>
            <div>
                <b>String</b>：
                <input id="inHexString" type="text" placeholder="transfer" maxlength="50" />----> Hex String ：
                <span id="outHexString" class="trans-text"></span>
            </div>
            <input id="transform1" type="button" value="Transform">
        </form>
        <hr />
        <form class="trans-area">
            <div>
                <div class="trans-ex"><b>Address (big endian)</b></div>
                <div class="trans-ex"><b>e.g</b>： 0xecc6b20d3ccac1ee9ef109af5a7cdb85706b1df9 - AeV59NyZtgj5AMQ7vY6yhr2MRvcfFeLWSb</div>
                <b>Script Hash</b>： 0x
                <input id="inXScriptHash" type="text" placeholder="ecc6b20d3ccac1ee9ef109af5a7cdb85706b1df9" maxlength="50" />----> Address ：
                <span id="outXScriptHash" class="trans-text"></span>
            </div>
            <div>
                <b>Address</b>：
                <input id="inXAddress" type="text" placeholder="AeV59NyZtgj5AMQ7vY6yhr2MRvcfFeLWSb" maxlength="50" />----> Script Hash ： 0x
                <span id="outXAddress" class="trans-text"></span>
            </div>
            <input id="transform2" type="button" value="Transform">
        </form>
        <hr />
        <form class="trans-area">
            <div>
                <div class="trans-ex"><b>Address (little endian)</b></div>
                <div class="trans-ex"><b>e.g</b>： d336d7eb9975a29b2404fdb28185e277a4b299bc - Ab2fvZdmnM4HwDgVbdBrbTLz1wK5TcEyhU</div>
                <b>Script Hash</b>：
                <input id="inScriptHash" type="text" placeholder="d336d7eb9975a29b2404fdb28185e277a4b299bc" maxlength="50" />----> Address ：
                <span id="outScriptHash" class="trans-text"></span>
            </div>
            <div>
                <b>Address</b>：
                <input id="inAddress" type="text" placeholder="Ab2fvZdmnM4HwDgVbdBrbTLz1wK5TcEyhU" maxlength="50" />----> Script Hash ：
                <span id="outAddress" class="trans-text"></span>
            </div>
            <input id="transform3" type="button" value="Transform">
        </form>
        <hr />
        <form class="trans-area">
            <div>
                <div class="trans-ex"><b>Number</b></div>
                <div class="trans-ex"><b>e.g</b>： 00e1f505 - 100000000</div>
                <b>Hex Number</b>：
                <input id="inHexNum" type="text" placeholder="00e1f505" maxlength="50" />----> Number ：
                <span id="outHexNum" class="trans-text"></span>
            </div>
            <div>
                <b>number</b>：
                <input id="inNum" type="text" placeholder="100000000" maxlength="50" />----> Hex Number ：
                <span id="outNum" class="trans-text"></span>
            </div>
            <input id="transform4" type="button" value="Transform">
        </form>
        <hr />
        <form class="trans-area">
            <div>
                <div class="trans-ex"><b>Script Hash (Big-endian/Little-endian)</b></div>
                <div class="trans-ex"><b>e.g</b>： 0xbc99b2a477e28581b2fd04249ba27599ebd736d3 - d336d7eb9975a29b2404fdb28185e277a4b299bc</div>
                <b>script hash(big/little)</b>：
                <input id="inSmall" type="text" placeholder="0xbc99b2a477e28581b2fd04249ba27599ebd736d3" maxlength="50" />----> script hash(little/big)：
                <span id="outSmall" class="trans-text"></span>
            </div>
            <input id="transform5" type="button" value="Transform">
        </form>
        <hr />
        <form class="search-area">
            <div>
                <div class="script-left">
                    <div class="trans-ex"><b>Amount：</b><input placeholder="11" type="text" id="trans3"> * 10<sup>8</sup></div>
                    <div class="trans-ex"><b>To：</b><input placeholder="AHsEeUnSY9Kk7fba5MCXWSgZeyZNtWSv9x" type="text" id="trans2"></div>
                    <div class="trans-ex"><b>From：</b><input placeholder="AV8hdNibrG7r8fdVKSY6AgeHnssKQ1Smg8" type="text" id="trans1"></div>
                    <div class="trans-ex"><b>Contract Scripthash：</b><input placeholder="0x56c346b95bec05bd9e641c82b84bc229be6fe629" type="text" id="trans4"></div>
                 </div>
                <div class="script-right">
                    <span id="outScr"></span>
                    <span id="outscript1"></span>
                    <span id="outscript2"></span>
                    <span id="outscript3"></span>
                </div>
            </div>
            <input id="transscript" type="button" value="Transform">
        </form>
    </div>

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="strapdown/strapdown.js"></script>
    <script type="text/javascript" src="js/bundleDemo.js"></script>
    <!--<script type="text/javascript" src="js/appBundle.js"></script>-->
    <script>
      $(function () {
          var Trans = (function () {
              function Trans() {
              }
              Trans.hexToString = function (hex) {
                  var trimhex = hex.trim();
                  var rawStr = trimhex.substr(0, 2).toLowerCase() === "0x" ? trimhex.substr(2) : trimhex;
                  var len = rawStr.length;
                  if (len % 2 !== 0) {
                      alert("Illegal Format ASCII Code!");
                      return "";
                  }
                  var cuChar;
                  var result = [];
                  for (var i = 0; i < len; i = i + 2) {
                      cuChar = parseInt(rawStr.substr(i, 2), 16);
                      result.push(String.fromCharCode(cuChar));
                  }
                  return result;
              };
              Trans.prototype.hexToString = function (hex) {
                  return Trans.hexToString(hex);
              };
              Trans.stringToHex = function (str) {
                  if (str === "")
                      return "";
                  var hexChar = [];
                  for (var i = 0; i < str.length; i++) {
                      hexChar.push((str.charCodeAt(i)).toString(16));
                  }
                  return hexChar;
              };
              Trans.prototype.stringToHex = function (str) {
                  return Trans.stringToHex(str);
              };
              return Trans;
          }());
          $("input").keyup(function(){
                $(this).val($(this).val().replace(/[^A-Za-z0-9]/g,""));
          });
          $("#inAmount").keyup(function(){
                $(this).val($(this).val().replace(/\D/g,""));
          });
          $("input").on(function(){
                $(this).val($(this).val().replace(/[^A-Za-z0-9]/g,""));
          });
          $("#inAmount").on(function(){
                $(this).val($(this).val().replace(/\D/g,""));
          });
          $("#transform1").click(function () {//string
            var inStr = $("#inString").val();
              if (inStr) {
                  var outStr = Trans.hexToString(inStr).join("");
                  $("#outString").text(outStr);
              }
              var inHexString = $("#inHexString").val();
              if (inHexString) {
                  $("#outHexString").text(Trans.stringToHex(inHexString).join(""));
              }
          });
          $("#transform2").click(function () {//address(big endian)
            var inXScriptHash = $("#inXScriptHash").val();
              if (inXScriptHash) {
                  if(inXScriptHash.substr(0, 2)=="0x")inXScriptHash = inXScriptHash.slice(2);
                  if(inXScriptHash.length!=40){alert("Illegal Format Script Hash!");return;}
                  var hash160 = AntShares.Uint160.parse(inXScriptHash);
                  AntShares.Wallets.Wallet.toAddress(hash160).then(function (val) {
                      $("#outXScriptHash").text(val);
                  });
              }
              var inXAddress = $("#inXAddress").val();
              if (inXAddress) {
                  if(inXAddress.length!=34){alert("Illegal Format Address!");return;}
                  AntShares.Wallets.Wallet.toScriptHash(inXAddress).then(function (val) {
                      $("#outXAddress").text(val.toString());
                  });
              }
          });
          $("#transform3").click(function () {//address(little endian)
            var inScriptHash = $("#inScriptHash").val();
              if (inScriptHash) {
                  if(inScriptHash.substr(0, 2)=="0x"){alert("This is big endian Script Hash!");return;}
                  if(inScriptHash.length!=40){alert("Illegal Format Script Hash!");return;}
                  var xScriptHash = endianChange(inScriptHash);
                  if(xScriptHash.substr(0, 2)=="0x")xScriptHash = xScriptHash.slice(2);
                  var hash160 = AntShares.Uint160.parse(xScriptHash);
                  AntShares.Wallets.Wallet.toAddress(hash160).then(function (val) {
                      $("#outScriptHash").text(val);
                  });
              }
              var inAddress = $("#inAddress").val();
              if (inAddress) {
                  if(inAddress.length!=34){alert("Illegal Format Address!");return;}
                  AntShares.Wallets.Wallet.toScriptHash(inAddress).then(function (val) {
                      var xScriptHash = "0x" + val.toString();
                      var scriptHash = endianChange(xScriptHash);
                      $("#outAddress").text(scriptHash);
                  });
              }
          });
          $("#transform4").click(function () {//number
            var inHexNum = $("#inHexNum").val();
              if (inHexNum) {
                  var num = inHexNum.hexToBytes();
                  var a = new AntShares.BigInteger(num);
                  $("#outHexNum").text(a.toString());
              }
              var inNum = $("#inNum").val();
              if (inNum) {
                  var num = new AntShares.BigInteger(inNum);
                  $("#outNum").text(num.toUint8Array().toHexString());
              }
          });
          $("#transform5").click(function () {//address
              $(".trans-text").text("");              
              var inSmall = $("#inSmall").val();
              if (inSmall) {
                  if(inSmall.length!=40&&inSmall.length!=42){alert("Illegal Format Endian Address!");return;}
                  $("#outSmall").text(endianChange(inSmall));
              }
          });
          function endianChange(inSmall) {
              var result=[],num;
              if(inSmall.indexOf("0x")==0) {inSmall = inSmall.slice(2);
              }else if(inSmall){result = ['0x'];}
              var smaArray = inSmall.hexToBytes().reverse();
              for (var i = 0; i < smaArray.length; i++) {
                  num = smaArray[i];
                  if (num<16) {
                      num = smaArray[i].toString(16);
                      num="0"+num;
                  }else {num = smaArray[i].toString(16);}
                  result.push(num);
              }
              return result.join("");
          }
          
          $("#transscript").click(function () {
              var allfill = true;
              $(this).parent("form").find("input").each(function () {
                  if(!$(this).val()){allfill=false;alert("Please fill all content!");return false;}
              });
              if(allfill){
                  ad2LittleEndian($("#trans1").val(),1);
                  ad2LittleEndian($("#trans2").val(),2);
                  var trans3 = amount2hash($("#trans3").val())||"";
                  var trans4 = endianChange($("#trans4").val())||"";
                  var trans5 = "53c1";
                  var trans6 = "087472616e7366657267";
                  setTimeout(function(){
                      var trans1 = $("#outscript1").text()||"";
                      var trans2 = $("#outscript2").text()||"";
                      $("#outScr").text(trans3+trans2+trans1+trans5+trans6+trans4);
                  },0);
              }
          });
          function ad2LittleEndian(hash,num) {
              if (hash) {
                  if(hash.length!=34){alert("Illegal Format Address!");return;}
                  AntShares.Wallets.Wallet.toScriptHash(hash).then(function (val) {
                      var xScriptHash = "0x" + val.toString();
                      var res = endianChange(xScriptHash);
                      var length = (res.length/2).toString(16);
                      if(num==1){$("#outscript1").text(length+res);}
                      else {$("#outscript2").text(length+res);}
                  });
              }
          }
          function amount2hash(num){
              if (num) {
                  var hexnum = new AntShares.BigInteger(num*100000000);
                  var str = hexnum.toUint8Array().toHexString()+"00";
                  var len = getLength(str)+str;
                  return len;
              }
          }
          
          function getLength(len) {
              var _len = len.toString().length/2;
              if(_len<16){
                  _len = "0"+_len.toString(16);
              }else {
                  _len = _len.toString(16);
              }
              return _len;
          }
      });
    </script>
</body>
</html>